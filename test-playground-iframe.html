<!DOCTYPE html>
<!-- AUTOFILL TEST: test-playground-iframe.html replica -->
<!-- Exact FineUI field naming: name="ContentPanelN$field", id="ContentPanelN_field-inputEl" -->
<!-- Hidden combo value: name="ContentPanelN$field$Value" -->
<html><head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>å†…éƒ¨ç³»ç»Ÿ â€” test-playground-iframe.html</title>
<style>
  :root {
    --bg:       #1a1a1f;
    --bg2:      #22222a;
    --bg3:      #2a2a34;
    --bg4:      #181820;
    --border:   #38383f;
    --border2:  #44444e;
    --text:     #d8d8e8;
    --text-dim: #8888aa;
    --label-bg: #1e2030;
    --label-fg: #9ab0cc;
    --cell-bg:  #22222a;
    --accent:   #3c72c8;
    --accent2:  #29b87d;
    --accent3:  #e05555;
    --accent4:  #e8a930;
    --hover-row:#282835;
    --mono:     'Courier New', monospace;
    --radius:   4px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
    font-size: 12px;
    min-height: 100vh;
  }

  /* â”€â”€ Top info bar â”€â”€ */
  .top-bar {
    background: var(--bg3);
    border-bottom: 1px solid var(--border);
    padding: 6px 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 11px;
    color: var(--text-dim);
  }
  .top-bar .pill {
    background: rgba(60,114,200,.25);
    border: 1px solid rgba(60,114,200,.5);
    border-radius: 3px;
    padding: 1px 7px;
    color: #7ab0f8;
    font-family: var(--mono);
    font-size: 10px;
  }
  .top-bar .pill.asp { background: rgba(232,169,48,.15); border-color: rgba(232,169,48,.4); color: var(--accent4); }
  .top-bar .sep { color: var(--border2); }

  /* â”€â”€ Section panel â”€â”€ */
  .panel-wrap {
    margin: 14px 20px;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .panel-header {
    background: linear-gradient(90deg, #1e2636 0%, #1a1e2a 100%);
    border-bottom: 1px solid var(--border);
    padding: 7px 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .panel-header .ph-tag {
    font-size: 9px;
    font-weight: 800;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 2px 7px;
    border-radius: 3px;
    background: var(--accent);
    color: #fff;
  }
  .panel-header .ph-tag.p2 { background: #7c4dba; }
  .panel-header .ph-tag.p3 { background: var(--accent2); color: #000; }
  .panel-header .ph-tag.p4 { background: var(--accent4); color: #000; }
  .panel-header h3 { font-size: 11px; font-weight: 700; color: #a8c0e0; }

  /* â”€â”€ Table layout (FineUI blockpanel style) â”€â”€ */
  .tablehtml {
    width: 100%;
    border-collapse: collapse;
  }

  .tablehtml td {
    padding: 5px 10px;
    border: 1px solid var(--border);
    vertical-align: middle;
  }

  .tablehtml td.label {
    background: var(--label-bg);
    color: var(--label-fg);
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
    width: 160px;
    min-width: 140px;
  }

  .tablehtml td.content {
    background: var(--cell-bg);
    min-width: 160px;
  }

  /* â”€â”€ FineUI textbox â”€â”€ */
  .f-field-wrap {
    display: inline-block;
    width: 100%;
  }

  .f-textbox, .f-dropdownlist-text {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border2);
    border-radius: var(--radius);
    color: var(--text);
    font-size: 12px;
    padding: 5px 8px;
    outline: none;
    font-family: inherit;
    transition: border-color .18s, box-shadow .18s;
  }

  .f-textbox:focus, .f-dropdownlist-text:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(60,114,200,.2);
  }

  .f-textbox[readonly], .f-dropdownlist-text[readonly] {
    background: #1a1a22;
    color: var(--text-dim);
    border-color: var(--border);
  }

  /* NumberBox */
  .f-numberbox-wrap {
    position: relative;
    display: inline-block;
    width: 100%;
  }
  .f-numberbox-wrap .f-textbox {
    padding-right: 22px;
  }
  .f-numberbox-spinners {
    position: absolute;
    right: 0; top: 0; bottom: 0;
    width: 20px;
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--border2);
  }
  .f-spin-btn {
    flex: 1;
    background: var(--bg3);
    border: none;
    color: var(--text-dim);
    cursor: pointer;
    font-size: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .1s;
  }
  .f-spin-btn:hover { background: var(--bg4); color: var(--text); }
  .f-spin-btn:first-child { border-bottom: 1px solid var(--border2); }

  /* â”€â”€ FineUI DropDownList (ComboBox) â”€â”€ */
  .f-ddl-wrap {
    position: relative;
    display: inline-block;
    width: 100%;
  }

  .f-dropdownlist-text {
    padding-right: 28px;
    cursor: pointer;
  }

  .f-ddl-arrow {
    position: absolute;
    right: 0; top: 0; bottom: 0;
    width: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-left: 1px solid var(--border2);
    color: var(--text-dim);
    font-size: 9px;
    cursor: pointer;
    pointer-events: none;
    transition: background .1s;
  }

  .f-ddl-clear {
    position: absolute;
    right: 24px; top: 50%;
    transform: translateY(-50%);
    width: 16px; height: 16px;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-dim);
    font-size: 11px;
  }
  .f-ddl-wrap:hover .f-ddl-clear.has-value { display: flex; }

  .f-ddl-list {
    position: absolute;
    top: calc(100% + 2px);
    left: 0; right: 0;
    background: var(--bg3);
    border: 1px solid var(--accent);
    border-radius: var(--radius);
    z-index: 9999;
    max-height: 200px;
    overflow-y: auto;
    display: none;
    box-shadow: 0 6px 20px rgba(0,0,0,.6);
  }
  .f-ddl-list.open { display: block; }

  .f-ddl-item {
    padding: 6px 10px;
    cursor: pointer;
    font-size: 11px;
    color: var(--text);
    transition: background .1s;
    border-bottom: 1px solid rgba(255,255,255,.04);
  }
  .f-ddl-item:hover { background: var(--accent); color: #fff; }
  .f-ddl-item.selected { background: rgba(60,114,200,.25); color: #7ab0f8; }
  .f-ddl-item-empty { padding: 6px 10px; color: var(--text-dim); font-size: 11px; font-style: italic; }

  /* FineUI field hidden value badge */
  .hidden-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-top: 3px;
    font-size: 9px;
    font-family: var(--mono);
    background: rgba(232,169,48,.1);
    border: 1px solid rgba(232,169,48,.3);
    border-radius: 3px;
    padding: 1px 6px;
    color: var(--accent4);
  }

  /* â”€â”€ ContentPanel3 buttons â”€â”€ */
  .f-btn {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 6px 14px;
    border-radius: var(--radius);
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border2);
    background: var(--bg3);
    color: var(--text);
    transition: all .15s;
    text-decoration: none;
    font-family: inherit;
  }
  .f-btn:hover { background: var(--accent); border-color: var(--accent); color: #fff; }
  .f-btn.btn-save { background: rgba(41,184,125,.15); border-color: rgba(41,184,125,.4); color: var(--accent2); }
  .f-btn.btn-save:hover { background: var(--accent2); color: #000; }
  .f-btn.btn-reset { background: rgba(232,169,48,.1); border-color: rgba(232,169,48,.3); color: var(--accent4); }
  .f-btn.btn-reset:hover { background: var(--accent4); color: #000; }

  /* â”€â”€ Grid (ContentPanel4) â”€â”€ */
  .f-grid-wrap {
    overflow-x: auto;
    background: var(--bg2);
  }

  .f-grid {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    min-width: 1400px;
  }

  .f-grid thead th {
    background: var(--bg4);
    color: var(--text-dim);
    font-weight: 700;
    padding: 7px 8px;
    border: 1px solid var(--border);
    text-align: left;
    white-space: nowrap;
    font-size: 10px;
    letter-spacing: 0.3px;
  }

  .f-grid tbody tr { transition: background .1s; }
  .f-grid tbody tr:hover { background: var(--hover-row); }
  .f-grid tbody tr.alt { background: rgba(255,255,255,.02); }

  .f-grid tbody td {
    padding: 5px 8px;
    border: 1px solid var(--border);
    color: var(--text);
    vertical-align: middle;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .f-grid .td-del { text-align: center; width: 40px; }
  .f-grid .td-num { text-align: center; color: var(--text-dim); width: 30px; }
  .f-grid .td-mo  { font-family: var(--mono); font-size: 10px; color: var(--accent); }
  .f-grid .td-stt { font-family: var(--mono); font-size: 10px; color: var(--accent2); }
  .f-grid .td-time { font-family: var(--mono); font-size: 10px; color: var(--text-dim); }
  .f-grid .td-spec { max-width: 220px; font-size: 10px; }

  .del-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px; height: 22px;
    background: rgba(224,85,85,.15);
    border: 1px solid rgba(224,85,85,.3);
    border-radius: 3px;
    color: var(--accent3);
    cursor: pointer;
    font-size: 13px;
    transition: all .15s;
    text-decoration: none;
  }
  .del-btn:hover { background: var(--accent3); color: #fff; }

  /* â”€â”€ Output / payload panel â”€â”€ */
  .output-panel {
    margin: 0 20px 14px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    background: var(--bg4);
  }
  .output-header {
    background: var(--bg3);
    border-bottom: 1px solid var(--border);
    padding: 5px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }
  .output-header h4 {
    font-size: 9px; font-weight: 800;
    letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim);
  }
  .output-header .dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--accent2); animation: pulse 1.5s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }
  .output-pre {
    padding: 12px; font-family: var(--mono); font-size: 10px;
    color: var(--accent2); white-space: pre-wrap; word-break: break-all;
    max-height: 180px; overflow-y: auto;
  }

  /* â”€â”€ Debug log â”€â”€ */
  .debug-panel {
    margin: 0 20px 14px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }
  .debug-header {
    background: var(--bg3); border-bottom: 1px solid var(--border);
    padding: 5px 12px; display: flex; align-items: center; justify-content: space-between;
  }
  .debug-header span { font-size: 9px; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim); }
  .debug-log {
    max-height: 140px; overflow-y: auto;
    padding: 6px 10px; font-family: var(--mono); font-size: 10px; line-height: 1.8;
    background: var(--bg4);
  }
  .le { display: flex; gap: 8px; padding: 1px 3px; border-radius: 2px; }
  .le:hover { background: var(--bg3); }
  .lt { color: var(--text-dim); flex-shrink: 0; }
  .lk { flex-shrink: 0; width: 55px; text-align: right; }
  .lk.change { color: var(--accent); }
  .lk.input  { color: var(--accent2); }
  .lk.hidden { color: var(--accent4); }
  .lk.submit { color: var(--accent3); }
  .lk.dom    { color: #a78bfa; }
  .lm { color: var(--text); flex: 1; word-break: break-all; }

  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

  .clear-btn { font-size: 9px; padding: 2px 7px; border-radius: 3px; border: 1px solid var(--border2); background: transparent; color: var(--text-dim); cursor: pointer; }
  .clear-btn:hover { border-color: var(--accent3); color: var(--accent3); }

  .hidden-fields-info {
    margin: 6px 20px 0;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    font-family: var(--mono);
    font-size: 10px;
  }
  .hf-item {
    background: rgba(60,114,200,.1);
    border: 1px solid rgba(60,114,200,.25);
    border-radius: 3px;
    padding: 2px 8px;
    color: #7ab0f8;
  }
  .hf-item .hf-name { color: var(--accent4); }
  .hf-item .hf-val  { color: var(--text-dim); font-size: 9px; margin-left: 3px; }
</style>
</head>
<body>

<!-- Top info bar -->
<div class="top-bar">
  <span class="pill asp">ASP.NET WebForms</span>
  <span class="sep">|</span>
  <span class="pill">FineUI v3.x</span>
  <span class="sep">|</span>
  <span>test-playground-iframe.html</span>
  <span class="sep">|</span>
  <span id="originSpan" style="color:#5577aa">loading...</span>
</div>

<form method="post" action="./test-playground-iframe.html" id="Form1" autocomplete="off">

<!-- â”€â”€â”€ ASP.NET hidden tokens â”€â”€â”€ -->
<div class="aspNetHidden" style="display:none">
  <input type="hidden" name="__EVENTTARGET"           id="__EVENTTARGET"           value="ContentPanel1$tbxmo">
  <input type="hidden" name="__EVENTARGUMENT"         id="__EVENTARGUMENT"         value="Blur">
  <input type="hidden" name="__VIEWSTATE"             id="__VIEWSTATE"             value="/wEPDwUKMTk2NDY3NDQxNA9kFgICAw8WAh4MYXV0b2NvbXBsZXRlBQNvZmZkGAIFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYiBQ1Db250ZW50UGFuZWwx">
  <input type="hidden" name="__VIEWSTATEGENERATOR"   id="__VIEWSTATEGENERATOR"   value="B207494D">
</div>

<!-- Hidden fields info display (for extension testing visibility) -->
<div class="hidden-fields-info">
  <div class="hf-item"><span class="hf-name">__EVENTTARGET</span><span class="hf-val">ContentPanel1$tbxmo</span></div>
  <div class="hf-item"><span class="hf-name">__EVENTARGUMENT</span><span class="hf-val">Blur</span></div>
  <div class="hf-item"><span class="hf-name">__VIEWSTATE</span><span class="hf-val">/wEPDwUKMTk2NDY3Nâ€¦ (truncated)</span></div>
  <div class="hf-item"><span class="hf-name">__VIEWSTATEGENERATOR</span><span class="hf-val">B207494D</span></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ContentPanel1 â€” Header info (MO â†’ Line)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel-wrap">
  <div class="panel-header">
    <span class="ph-tag">Panel 1</span>
    <h3>åŸºæœ¬ä¿¡æ¯ ThÃ´ng tin cÆ¡ báº£n â€” MO / Model / Version / Line</h3>
  </div>
  <div style="padding:10px">
    <table class="tablehtml">
      <tbody>
        <tr>
          <!-- MO: text, EDITABLE â€” trigger postback on blur -->
          <td class="label">MOï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel1_tbxmo">
              <input id="ContentPanel1_tbxmo-inputEl"
                     class="f-textbox"
                     type="text"
                     name="ContentPanel1$tbxmo"
                     placeholder="Enter MO number..."
                     autocomplete="off">
            </div>
          </td>

          <!-- æœºå‹ Model: readonly text (auto-filled after MO lookup) -->
          <td class="label">æœºå‹ Modelï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel1_tbxjx">
              <input id="ContentPanel1_tbxjx-inputEl"
                     class="f-textbox"
                     type="text"
                     name="ContentPanel1$tbxjx"
                     readonly
                     autocomplete="off"
                     placeholder="auto-filled">
            </div>
          </td>

          <!-- ç‰ˆæœ¬ Version: readonly -->
          <td class="label">ç‰ˆæœ¬ Versionï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel1_tbxbb">
              <input id="ContentPanel1_tbxbb-inputEl"
                     class="f-textbox"
                     type="text"
                     name="ContentPanel1$tbxbb"
                     readonly
                     autocomplete="off"
                     placeholder="auto-filled">
            </div>
          </td>
        </tr>
        <tr>
          <!-- æ‰¹é‡ sá»‘ lÆ°á»£ng: readonly -->
          <td class="label">æ‰¹é‡ sá»‘ lÆ°á»£ngï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel1_tbxpl">
              <input id="ContentPanel1_tbxpl-inputEl"
                     class="f-textbox"
                     type="text"
                     name="ContentPanel1$tbxpl"
                     readonly
                     autocomplete="off"
                     placeholder="auto-filled">
            </div>
          </td>

          <!-- æˆå“æ–™å· PN: readonly -->
          <td class="label">æˆå“æ–™å· PNï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel1_tbxcplh">
              <input id="ContentPanel1_tbxcplh-inputEl"
                     class="f-textbox"
                     type="text"
                     name="ContentPanel1$tbxcplh"
                     readonly
                     autocomplete="off"
                     placeholder="auto-filled">
            </div>
          </td>

          <!-- çº¿åˆ« Line: FineUI DropDownList â€” has $Value hidden -->
          <td class="label">çº¿åˆ« Lineï¼š</td>
          <td class="content">
            <div id="ContentPanel1_ddlxb" class="f-ddl-wrap">
              <input type="hidden"
                     name="ContentPanel1$ddlxb$Value"
                     id="ContentPanel1_ddlxb-hiddenEl"
                     value="">
              <input id="ContentPanel1_ddlxb-inputEl"
                     class="f-dropdownlist-text"
                     type="text"
                     name="ContentPanel1$ddlxb"
                     autocomplete="off"
                     placeholder="Select line..."
                     readonly>
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel1_ddlxb-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlxb">$Value: <strong>â€”</strong></div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ContentPanel2 â€” Defect details
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel-wrap">
  <div class="panel-header">
    <span class="ph-tag p2">Panel 2</span>
    <h3>ä¸è‰¯è¯¦æƒ… Chi tiáº¿t lá»—i â€” NguyÃªn nhÃ¢n / PhÆ°Æ¡ng phÃ¡p / ÄÆ¡n vá»‹</h3>
  </div>
  <div style="padding:10px">
    <table class="tablehtml">
      <tbody>
        <tr>
          <!-- ä¸è‰¯åŸå› : DDL + $Value hidden -->
          <td class="label">ä¸è‰¯åŸå›  NguyÃªn nhÃ¢n khÃ´ng Ä‘áº¡tï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlblyy" class="f-ddl-wrap">
              <input type="hidden" name="ContentPanel2$ddlblyy$Value" id="ContentPanel2_ddlblyy-hiddenEl" value="">
              <input id="ContentPanel2_ddlblyy-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlblyy" autocomplete="off" placeholder="Select..." readonly>
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlblyy-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlblyy">$Value: <strong>â€”</strong></div>
          </td>

          <!-- å¤„ç†æ–¹æ³•: DDL + $Value hidden (readonly text) -->
          <td class="label">å¤„ç†æ–¹æ³• PhÆ°Æ¡ng phÃ¡p xá»­ lÃ­ï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlclff" class="f-ddl-wrap">
              <input type="hidden" name="ContentPanel2$ddlclff$Value" id="ContentPanel2_ddlclff-hiddenEl" value="">
              <input id="ContentPanel2_ddlclff-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlclff" autocomplete="off" readonly
                     placeholder="auto from ä¸è‰¯åŸå› ...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlclff-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlclff">$Value: <strong>â€”</strong></div>
          </td>

          <!-- è´£ä»»å•ä½: DDL + $Value hidden (readonly) -->
          <td class="label">è´£ä»»å•ä½ ÄÆ¡n vá»‹ phá»¥ trÃ¡chï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlzrdw" class="f-ddl-wrap">
              <input type="hidden" name="ContentPanel2$ddlzrdw$Value" id="ContentPanel2_ddlzrdw-hiddenEl" value="">
              <input id="ContentPanel2_ddlzrdw-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlzrdw" autocomplete="off" readonly
                     placeholder="auto from ä¸è‰¯åŸå› ...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlzrdw-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlzrdw">$Value: <strong>â€”</strong></div>
          </td>
        </tr>
        <tr>
          <!-- åŒºåˆ†: DDL + $Value hidden (readonly) -->
          <td class="label">åŒºåˆ† PhÃ¢n tÃ­chï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlqf" class="f-ddl-wrap">
              <input type="hidden" name="ContentPanel2$ddlqf$Value" id="ContentPanel2_ddlqf-hiddenEl" value="">
              <input id="ContentPanel2_ddlqf-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlqf" autocomplete="off" readonly placeholder="Select...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlqf-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlqf">$Value: <strong>â€”</strong></div>
          </td>

          <!-- äº§å“çŠ¶æ€: DDL + $Value hidden (readonly) -->
          <td class="label">äº§å“çŠ¶æ€ tráº¡ng thÃ¡i sáº£n pháº©mï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlcpzt" class="f-ddl-wrap">
              <input type="hidden" name="ContentPanel2$ddlcpzt$Value" id="ContentPanel2_ddlcpzt-hiddenEl" value="">
              <input id="ContentPanel2_ddlcpzt-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlcpzt" autocomplete="off" readonly placeholder="Select...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlcpzt-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlcpzt">$Value: <strong>â€”</strong></div>
          </td>

          <!-- å­æ¯æ¿: DDL NO $Value hidden (readonly) -->
          <td class="label">å­æ¯æ¿ Báº£n Conï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlzmb" class="f-ddl-wrap">
              <!-- NOTE: no hidden $Value input here â€” extension must handle this case -->
              <input id="ContentPanel2_ddlzmb-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlzmb" autocomplete="off" readonly placeholder="Select...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlzmb-list"></div>
            </div>
            <div class="hidden-badge" style="border-color:rgba(224,85,85,.4);color:var(--accent3)">âš  NO $Value hidden input</div>
          </td>
        </tr>
        <tr>
          <!-- å…ƒä»¶ä½å·: DDL EDITABLE (no readonly, no $Value hidden) -->
          <td class="label">å…ƒä»¶ä½å· MÃ£ linh kiá»‡nï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlwh" class="f-ddl-wrap">
              <!-- no hidden $Value here either â€” just text input -->
              <input id="ContentPanel2_ddlwh-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlwh" autocomplete="off"
                     placeholder="Type to filter or select...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlwh-list"></div>
            </div>
            <div class="hidden-badge" style="border-color:rgba(224,85,85,.4);color:var(--accent3)">âš  NO $Value hidden input (editable)</div>
          </td>

          <!-- å…ƒä»¶è§„æ ¼: DDL readonly NO $Value hidden -->
          <td class="content" colspan="3">
            <div style="margin-bottom:4px;font-size:10px;color:var(--text-dim)">å…ƒä»¶è§„æ ¼ Quy cÃ¡ch mÃ´ hÃ¬nhï¼š</div>
            <div id="ContentPanel2_ddlyjgg" class="f-ddl-wrap">
              <input id="ContentPanel2_ddlyjgg-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlyjgg" autocomplete="off" readonly
                     placeholder="auto from å…ƒä»¶ä½å·...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlyjgg-list"></div>
            </div>
          </td>
        </tr>
        <tr>
          <!-- å…ƒä»¶å‘¨æœŸ: text editable -->
          <td class="label">å…ƒä»¶å‘¨æœŸ NgÃ y thÃ¡ng linh kiá»‡nï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel2_tbxyjzq">
              <input id="ContentPanel2_tbxyjzq-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxyjzq" autocomplete="off" placeholder="e.g. 2024Q1">
            </div>
          </td>

          <!-- åºåˆ—å· STT: text editable -->
          <td class="label">åºåˆ—å· STTï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel2_tbxxlh">
              <input id="ContentPanel2_tbxxlh-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxxlh" autocomplete="off"
                     placeholder="e.g. YCFA196000334">
            </div>
          </td>

          <!-- ä¸è‰¯ç°è±¡: DDL + $Value hidden -->
          <td class="label">ä¸è‰¯ç°è±¡ Hiá»‡n tÆ°á»£ng lá»—iï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddlblxx" class="f-ddl-wrap">
              <input type="hidden" name="ContentPanel2$ddlblxx$Value" id="ContentPanel2_ddlblxx-hiddenEl" value="">
              <input id="ContentPanel2_ddlblxx-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddlblxx" autocomplete="off" placeholder="Select...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddlblxx-list"></div>
            </div>
            <div class="hidden-badge" id="badge-ddlblxx">$Value: <strong>â€”</strong></div>
          </td>
        </tr>
        <tr>
          <!-- ç‰©æ–™æ–™å·: text editable -->
          <td class="label">ç‰©æ–™æ–™å· MÃ£ váº­t liá»‡uï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel2_tbxwldm">
              <input id="ContentPanel2_tbxwldm-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxwldm" autocomplete="off"
                     placeholder="e.g. 2420500037">
            </div>
          </td>

          <!-- ä¸è‰¯æ•°é‡: NumberBox -->
          <td class="label">ä¸è‰¯æ•°é‡ Sá»‘ lÆ°á»£ng lá»—iï¼š</td>
          <td class="content">
            <div class="f-numberbox-wrap" id="ContentPanel2_tbxblsl">
              <input id="ContentPanel2_tbxblsl-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxblsl" autocomplete="off"
                     placeholder="0">
              <div class="f-numberbox-spinners">
                <button type="button" class="f-spin-btn" onclick="spinNum('ContentPanel2_tbxblsl-inputEl',1)">â–²</button>
                <button type="button" class="f-spin-btn" onclick="spinNum('ContentPanel2_tbxblsl-inputEl',-1)">â–¼</button>
              </div>
            </div>
          </td>

          <!-- å¤‡æ³¨ Ghi chÃº: text editable -->
          <td class="label">å¤‡æ³¨ Ghi chÃºï¼š</td>
          <td class="content">
            <div class="f-field-wrap" id="ContentPanel2_tbxnbz">
              <input id="ContentPanel2_tbxnbz-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxnbz" autocomplete="off" placeholder="Notes...">
            </div>
          </td>
        </tr>
        <tr>
          <!-- å¤šé€‰ä½å·: DDL editable no $Value hidden -->
          <td class="label">å¤šé€‰ä½å· Sá»‘ bit nhiá»u lá»±a chá»nï¼š</td>
          <td class="content">
            <div id="ContentPanel2_ddldgwh" class="f-ddl-wrap">
              <input id="ContentPanel2_ddldgwh-inputEl" class="f-dropdownlist-text" type="text"
                     name="ContentPanel2$ddldgwh" autocomplete="off"
                     placeholder="Multi-select position...">
              <span class="f-ddl-arrow">â–¼</span>
              <div class="f-ddl-list" id="ContentPanel2_ddldgwh-list"></div>
            </div>
          </td>

          <!-- å¤šä¸ªæ–™å·: text editable (colspan 3) -->
          <td class="label">å¤šä¸ªæ–™å· Nhiá»u sá»‘ máº·t hÃ ngï¼š</td>
          <td class="content" colspan="3">
            <div class="f-field-wrap" id="ContentPanel2_tbxdxwhlh">
              <input id="ContentPanel2_tbxdxwhlh-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxdxwhlh" autocomplete="off" style="width:100%"
                     placeholder="Multiple item codes separated by comma...">
            </div>
          </td>
        </tr>
        <tr>
          <!-- å¤šä¸ªè§„æ ¼: text editable (colspan 5) -->
          <td class="label">å¤šä¸ªè§„æ ¼ Nhiá»u thÃ´ng sá»‘ ká»¹ thuáº­tï¼š</td>
          <td class="content" colspan="5">
            <div class="f-field-wrap" id="ContentPanel2_tbxdxwhms">
              <input id="ContentPanel2_tbxdxwhms-inputEl" class="f-textbox" type="text"
                     name="ContentPanel2$tbxdxwhms" autocomplete="off" style="width:100%"
                     placeholder="Multiple specs...">
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ContentPanel3 â€” Buttons + hidden auxiliary fields
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel-wrap">
  <div class="panel-header">
    <span class="ph-tag p3">Panel 3</span>
    <h3>æ“ä½œæŒ‰é’® Thao tÃ¡c + Hidden auxiliary fields</h3>
  </div>
  <div style="padding:12px 14px;display:flex;flex-wrap:wrap;gap:10px;align-items:center">

    <a id="ContentPanel3_btnTJ" class="f-btn btn-save" href="javascript:void(0)"
       onclick="handleBtnTJ()">
      ğŸ’¾ æ·»åŠ å…ƒä»¶ ThÃªm vÃ o
    </a>

    <a id="ContentPanel3_btnCZ" class="f-btn btn-reset" href="javascript:void(0)"
       onclick="handleBtnCZ()">
      â†º é‡ç½® CÃ i láº¡i
    </a>

    <a id="ContentPanel3_btnGet" class="f-btn" href="javascript:void(0)"
       onclick="handleBtnGet()">
      ğŸ” è·å–å¤šé€‰ä½å·å¯¹åº”æ–™å·å’Œè§„æ ¼ nháº­n Ä‘Æ°á»£c
    </a>

    <!-- Hidden auxiliary text fields (display:none â€” extension edge case) -->
    <div style="display:none" id="ContentPanel3_tbxzwl">
      <input id="ContentPanel3_tbxzwl-inputEl" type="text"
             name="ContentPanel3$tbxzwl" autocomplete="off">
    </div>
    <div style="display:none" id="ContentPanel3_tbxwllb">
      <input id="ContentPanel3_tbxwllb-inputEl" type="text"
             name="ContentPanel3$tbxwllb" autocomplete="off">
    </div>
    <div style="display:none" id="ContentPanel3_tbxcnname">
      <input id="ContentPanel3_tbxcnname-inputEl" type="text"
             name="ContentPanel3$tbxcnname" autocomplete="off">
    </div>

    <span style="font-size:10px;color:var(--text-dim);margin-left:10px">
      âš  3 hidden inputs: <code style="color:var(--accent4);font-size:9px">tbxzwl, tbxwllb, tbxcnname</code> (display:none)
    </span>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ContentPanel4 â€” Grid (data table)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel-wrap">
  <div class="panel-header">
    <span class="ph-tag p4">Panel 4</span>
    <h3>Grid1 â€” ç»´ä¿®è®°å½• Lá»‹ch sá»­ sá»­a chá»¯a</h3>
  </div>
  <div class="f-grid-wrap" style="padding:0">
    <table class="f-grid" id="ContentPanel4_Grid1">
      <thead>
        <tr>
          <th class="td-del"></th>
          <th class="td-num">#</th>
          <th>MO</th>
          <th>ä¸è‰¯åŸå›  NguyÃªn nhÃ¢n</th>
          <th>å¤„ç†æ–¹æ³• PhÆ°Æ¡ng phÃ¡p</th>
          <th>è´£ä»»å•ä½ ÄÆ¡n vá»‹</th>
          <th>åŒºåˆ† PhÃ¢n tÃ­ch</th>
          <th>å­æ¯æ¿ Báº£n Con</th>
          <th>å…ƒä»¶ä½å· MÃ£ linh kiá»‡n</th>
          <th>ç‰©æ–™æ–™å· MÃ£ váº­t liá»‡u</th>
          <th>å…ƒä»¶è§„æ ¼ Quy cÃ¡ch</th>
          <th>ä¸è‰¯ç°è±¡ Hiá»‡n tÆ°á»£ng</th>
          <th>åºå· STT</th>
          <th>å¤‡æ³¨ Ghi chÃº</th>
          <th>æ“ä½œæ—¶é—´ Thá»i gian</th>
        </tr>
      </thead>
      <tbody id="grid-tbody">
        <!-- Populated by JS -->
      </tbody>
    </table>
  </div>
</div>

</form><!-- /Form1 -->

<!-- Payload output -->
<div class="output-panel">
  <div class="output-header">
    <h4>ğŸ“¦ SUBMITTED PAYLOAD â€” Form1</h4>
    <span class="dot"></span>
  </div>
  <pre class="output-pre" id="formOutput">â€” Form not submitted yet â€”</pre>
</div>

<!-- Event log -->
<div class="debug-panel">
  <div class="debug-header">
    <span>ğŸ“¡ Event Log (iframe)</span>
    <button class="clear-btn" onclick="clearLog()">Clear</button>
  </div>
  <div class="debug-log" id="dbgLog">
    <div class="le"><span class="lt">--:--:--</span><span class="lk dom">dom</span><span class="lm">iframe-form.html loaded</span></div>
  </div>
</div>

<script>
'use strict';

// â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $ = id => document.getElementById(id);
const esc = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const ts  = () => new Date().toTimeString().slice(0,8);

function log(type, msg) {
  const box = $('dbgLog');
  const d = document.createElement('div');
  d.className = 'le';
  d.innerHTML = `<span class="lt">${ts()}</span><span class="lk ${type}">${type}</span><span class="lm">${esc(msg)}</span>`;
  box.appendChild(d);
  box.scrollTop = box.scrollHeight;
  try { window.parent.postMessage({ type:'iframe-log', logType:type, msg }, '*'); } catch(e) {}
}
function clearLog() { $('dbgLog').innerHTML=''; log('dom','Log cleared'); }

// â”€â”€ Display origin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$('originSpan').textContent = window.location.href.slice(0,70);

// â”€â”€ Data: FineUI dropdown options (extracted from real system) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DDL_DATA = {
  // çº¿åˆ« Line
  'ddlxb': [
    { text:'SMT Line A', value:'SMTA' },
    { text:'SMT Line B', value:'SMTB' },
    { text:'SMT Line C', value:'SMTC' },
    { text:'DIP Line 1', value:'DIP1' },
    { text:'DIP Line 2', value:'DIP2' },
  ],
  // ä¸è‰¯åŸå›  NguyÃªn nhÃ¢n khÃ´ng Ä‘áº¡t
  'ddlblyy': [
    { text:'æ’ä»¶ Va cháº¡m,vá»¡',   value:'ZJ' },
    { text:'ç¿˜ä»¶ Äá»©ng liá»‡u',    value:'QJ' },
    { text:'ä¸è‰¯ Lá»—i',          value:'BL' },
    { text:'å…ƒä»¶ç ´æŸ Vá»¡ liá»‡u',  value:'YJPS' },
    { text:'åå‘ NgÆ°á»£c chiá»u',  value:'FX' },
    { text:'æ¼ä»¶ Thiáº¿u liá»‡u',   value:'LJ' },
    { text:'ç«‹ç¢‘ Dá»±ng Ä‘á»©ng',    value:'LB' },
    { text:'ä½ç§» Lá»‡ch vá»‹ trÃ­',  value:'YY' },
  ],
  // å¤„ç†æ–¹æ³• PhÆ°Æ¡ng phÃ¡p xá»­ lÃ­
  'ddlclff': [
    { text:'è¡¥ä»¶ BÃ¹ kiá»‡n',                                        value:'BJ' },
    { text:'é‡æ–°ç„Šæ¥ Ä‘iá»u chá»‰nh vá»‹ trÃ­ vÃ  hÃ n cá»‘ Ä‘á»‹nh',           value:'ZXHJ' },
    { text:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u',                       value:'GHYJ' },
    { text:'è°ƒæ•´è¡¥ç„Š Diá»u chá»‰nh BÃ¹ thiáº¿c',                        value:'TZBH' },
    { text:'è¡¥é”¡ BÃ¹ chÃ¬',                                         value:'BX' },
  ],
  // è´£ä»»å•ä½ ÄÆ¡n vá»‹ phá»¥ trÃ¡ch
  'ddlzrdw': [
    { text:'åæ®µ CÃ´ng Ä‘oáº¡n sau',  value:'HD' },
    { text:'SMT',                 value:'SMT' },
    { text:'ç‰©æ–™ Váº­t liá»‡u',       value:'WL' },
    { text:'è®¾è®¡ Thiáº¿t káº¿',       value:'SJ' },
  ],
  // åŒºåˆ† PhÃ¢n tÃ­ch
  'ddlqf': [
    { text:'æ¼ä»¶ Thiáº¿u liá»‡u',     value:'LJ' },
    { text:'ç¿˜ä»¶ Äá»©ng liá»‡u',      value:'QJ' },
    { text:'åä»¶ liá»‡u há»ng',      value:'HJ' },
    { text:'æ–¹å‘å láº¯p ngÆ°á»£c liá»‡u',value:'FXF' },
    { text:'å‡ç„Š HÃ n giáº£',        value:'JH' },
    { text:'è¿é”¡ DÃ­nh chÃ¬',       value:'LX' },
  ],
  // äº§å“çŠ¶æ€
  'ddlcpzt': [
    { text:'åˆæ ¼ Äáº¡t',      value:'HG' },
    { text:'ä¸åˆæ ¼ KhÃ´ng Ä‘áº¡t', value:'BHG' },
    { text:'å¾…å®š Chá» xá»­ lÃ½', value:'DD' },
  ],
  // å­æ¯æ¿
  'ddlzmb': [
    { text:'æ—  khÃ´ng cÃ³', value:'W' },
    { text:'å­æ¿ báº£n phá»¥', value:'ZB' },
    { text:'æ¯æ¿ báº£n chÃ­nh', value:'MB' },
  ],
  // å…ƒä»¶ä½å· MÃ£ linh kiá»‡n
  'ddlwh': [
    { text:'T56', value:'T56' }, { text:'U64', value:'U64' },
    { text:'U50', value:'U50' }, { text:'T45', value:'T45' },
    { text:'U1',  value:'U1'  }, { text:'U28', value:'U28' },
    { text:'D1',  value:'D1'  }, { text:'U16', value:'U16' },
    { text:'L48', value:'L48' }, { text:'L50', value:'L50' },
    { text:'L144',value:'L144'}, { text:'L141',value:'L141'},
    { text:'Q12', value:'Q12' }, { text:'D2',  value:'D2'  },
    { text:'J22', value:'J22' }, { text:'J21', value:'J21' },
    { text:'U47', value:'U47' }, { text:'C100',value:'C100'},
    { text:'R210',value:'R210'}, { text:'C205',value:'C205'},
  ],
  // å…ƒä»¶è§„æ ¼ (mapped from å…ƒä»¶ä½å· for demo)
  'ddlyjgg': [
    { text:'CHIP-LAN-T|éš”ç¦»å˜å‹å™¨|1000BASE-T|4.6*3.4*3.2mm', value:'SPEC001' },
    { text:'IC|DC-DC|TPS563208DDCR|Buck|4.5-17V|3A|580kHz',  value:'SPEC002' },
    { text:'LED|3.2*1.0|ä¾§å‘å…‰|çº¢ç»¿è“ä¸‰è‰²|20mA',             value:'SPEC003' },
    { text:'IND|252012|1uH|M|3.6A/3.0A|0.054æ¬§',             value:'SPEC004' },
    { text:'Triode|3904|NPN|SOT-23',                          value:'SPEC005' },
    { text:'RFConnector|I-PEX|DC-6GHz',                       value:'SPEC006' },
  ],
  // ä¸è‰¯ç°è±¡
  'ddlblxx': [
    { text:'æ‹¼ä¸é€š Ping KhÃ´ng thÃ´ng',         value:'PBT' },
    { text:'åŠŸç‡ä½ CÃ´ng suáº¥t tháº¥p',           value:'GLL' },
    { text:'ç”µæºç¯ä¸äº® ÄÃ¨n nguá»“n KhÃ´ng sÃ¡ng', value:'DYDBL' },
    { text:'æ­»æœº Treo mÃ¡y',                   value:'SJ' },
    { text:'æ— ä¿¡å· Máº¥t tÃ­n hiá»‡u',             value:'WXH' },
  ],
  // å¤šé€‰ä½å·
  'ddldgwh': [
    { text:'D1,D2 (LED group)',    value:'D1D2' },
    { text:'U1,U2 (CPU group)',    value:'U1U2' },
    { text:'L48,L50 (IND group)',  value:'L4850' },
    { text:'T45,T56 (LAN group)',  value:'T4556' },
  ],
};

// â”€â”€ Hidden value interceptor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const origValDesc = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');

function interceptHidden(hiddenEl, badgeId) {
  Object.defineProperty(hiddenEl, 'value', {
    get() { return origValDesc.get.call(this); },
    set(v) {
      origValDesc.set.call(this, v);
      if (badgeId) {
        const b = $(badgeId);
        if (b) b.innerHTML = `$Value: <strong style="color:#e8c870">${v || '(empty)'}</strong>`;
      }
      log('hidden', `[hidden] name="${hiddenEl.name}" â†’ "${v}"`);
      hiddenEl.dispatchEvent(new Event('change', {bubbles:true}));
      hiddenEl.dispatchEvent(new Event('input',  {bubbles:true}));
    }
  });
  new MutationObserver(() => {
    const v = origValDesc.get.call(hiddenEl);
    if (badgeId) {
      const b = $(badgeId);
      if (b) b.innerHTML = `$Value: <strong style="color:#e8c870">${v || '(empty)'}</strong>`;
    }
  }).observe(hiddenEl, { attributes: true, attributeFilter: ['value'] });
}

// â”€â”€ Build FineUI DropDownList â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildDDL(fieldKey, panelId, opts = {}) {
  /*
   fieldKey: 'ddlblyy'
   panelId:  'ContentPanel2'
   opts.editable: bool (text input accepts typing)
   opts.noHidden: bool (no $Value hidden input)
   opts.badgeId:  id of badge element
   opts.onChange: callback(item)
  */
  const wrapperId  = `${panelId}_${fieldKey}`;
  const textId     = `${panelId}_${fieldKey}-inputEl`;
  const hiddenId   = `${panelId}_${fieldKey}-hiddenEl`;
  const listId     = `${panelId}_${fieldKey}-list`;

  const textEl   = $(textId);
  const hiddenEl = opts.noHidden ? null : $(hiddenId);
  const listEl   = $(listId);
  const data     = DDL_DATA[fieldKey] || [];

  if (!textEl || !listEl) return;

  if (hiddenEl) interceptHidden(hiddenEl, opts.badgeId || null);

  let selVal = '', selText = '', isOpen = false;

  function render(filter) {
    listEl.innerHTML = '';
    const items = opts.editable && filter
      ? data.filter(d => d.text.toLowerCase().includes(filter.toLowerCase()) ||
                         d.value.toLowerCase().includes(filter.toLowerCase()))
      : data;

    if (!items.length) {
      listEl.innerHTML = '<div class="f-ddl-item-empty">No results</div>';
      return;
    }
    items.forEach(item => {
      const d = document.createElement('div');
      d.className = 'f-ddl-item' + (item.value === selVal ? ' selected' : '');
      d.innerHTML = esc(item.text);
      d.addEventListener('mousedown', e => {
        e.preventDefault();
        selVal  = item.value;
        selText = item.text;
        textEl.value = item.text;
        if (hiddenEl) hiddenEl.value = item.value;
        textEl.dispatchEvent(new Event('input',  {bubbles:true}));
        textEl.dispatchEvent(new Event('change', {bubbles:true}));
        close();
        log('change', `[ddl] name="${textEl.name}" text="${item.text}" â†’ $Value="${item.value}"`);
        if (opts.onChange) opts.onChange(item);
      });
      listEl.appendChild(d);
    });
  }

  function open()  { render(opts.editable ? textEl.value : ''); listEl.classList.add('open'); isOpen = true; }
  function close() { listEl.classList.remove('open'); isOpen = false; }

  textEl.addEventListener('focus', () => open());
  if (opts.editable) {
    textEl.addEventListener('input', () => { render(textEl.value); if (!isOpen) open(); });
  }
  textEl.addEventListener('blur', () => setTimeout(close, 160));
  textEl.addEventListener('click', () => { if (isOpen) close(); else open(); });
}

// â”€â”€ Init all DDLs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Panel 1
buildDDL('ddlxb', 'ContentPanel1', { badgeId:'badge-ddlxb' });

// Panel 2 â€” dropdowns with $Value hidden
buildDDL('ddlblyy', 'ContentPanel2', {
  badgeId: 'badge-ddlblyy',
  onChange(item) {
    // Simulate dependent fields auto-populating (readonly readonly fields)
    log('dom', `[cascade] ddlblyy="${item.value}" â†’ auto-setting ddlclff, ddlzrdw, ddlqf`);
    // Simple cascade demo
    const cascadeMap = {
      'ZJ':  { clff:{ text:'è¡¥ä»¶ BÃ¹ kiá»‡n', value:'BJ' },              zrdw:{ text:'åæ®µ CÃ´ng Ä‘oáº¡n sau', value:'HD' }, qf:{ text:'æ¼ä»¶ Thiáº¿u liá»‡u', value:'LJ' }},
      'QJ':  { clff:{ text:'é‡æ–°ç„Šæ¥ Ä‘iá»u chá»‰nh vá»‹ trÃ­ vÃ  hÃ n cá»‘ Ä‘á»‹nh', value:'ZXHJ' }, zrdw:{ text:'SMT', value:'SMT' },              qf:{ text:'ç¿˜ä»¶ Äá»©ng liá»‡u', value:'QJ' }},
      'BL':  { clff:{ text:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u', value:'GHYJ' },             zrdw:{ text:'ç‰©æ–™ Váº­t liá»‡u', value:'WL' },      qf:{ text:'åä»¶ liá»‡u há»ng', value:'HJ' }},
      'YJPS':{ clff:{ text:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u', value:'GHYJ' },             zrdw:{ text:'åæ®µ CÃ´ng Ä‘oáº¡n sau', value:'HD' }, qf:{ text:'åä»¶ liá»‡u há»ng', value:'HJ' }},
      'FX':  { clff:{ text:'è°ƒæ•´è¡¥ç„Š Diá»u chá»‰nh BÃ¹ thiáº¿c', value:'TZBH' },              zrdw:{ text:'SMT', value:'SMT' },              qf:{ text:'æ–¹å‘å láº¯p ngÆ°á»£c liá»‡u', value:'FXF' }},
      'LJ':  { clff:{ text:'è¡¥ä»¶ BÃ¹ kiá»‡n', value:'BJ' },              zrdw:{ text:'åæ®µ CÃ´ng Ä‘oáº¡n sau', value:'HD' }, qf:{ text:'æ¼ä»¶ Thiáº¿u liá»‡u', value:'LJ' }},
    };
    const m = cascadeMap[item.value];
    if (!m) return;
    function setDDLVal(fieldKey, panelId, item) {
      const ti = $(`${panelId}_${fieldKey}-inputEl`);
      const hi = $(`${panelId}_${fieldKey}-hiddenEl`);
      if (ti) { ti.value = item.text; ti.dispatchEvent(new Event('change',{bubbles:true})); }
      if (hi) { hi.value = item.value; }
    }
    setDDLVal('ddlclff', 'ContentPanel2', m.clff);
    setDDLVal('ddlzrdw', 'ContentPanel2', m.zrdw);
    setDDLVal('ddlqf',   'ContentPanel2', m.qf);
  }
});
buildDDL('ddlclff', 'ContentPanel2', { badgeId:'badge-ddlclff' });
buildDDL('ddlzrdw', 'ContentPanel2', { badgeId:'badge-ddlzrdw' });
buildDDL('ddlqf',   'ContentPanel2', { badgeId:'badge-ddlqf' });
buildDDL('ddlcpzt', 'ContentPanel2', { badgeId:'badge-ddlcpzt' });
buildDDL('ddlzmb',  'ContentPanel2', { noHidden: true });
buildDDL('ddlwh',   'ContentPanel2', { noHidden: true, editable: true,
  onChange(item) {
    // Auto-set å…ƒä»¶è§„æ ¼ based on ä½å·
    const specMap = {
      T56:'SPEC001',T45:'SPEC001',U64:'SPEC002',U50:'SPEC002',
      U16:'SPEC002',D1:'SPEC003', D2:'SPEC003', L48:'SPEC004',
      L50:'SPEC004',L141:'SPEC004',L144:'SPEC004',Q12:'SPEC005',
      J22:'SPEC006',J21:'SPEC006', U47:'SPEC002',
    };
    const specVal = specMap[item.value];
    const specItem = (DDL_DATA['ddlyjgg'] || []).find(s => s.value === specVal);
    if (specItem) {
      const si = $('ContentPanel2_ddlyjgg-inputEl');
      if (si) { si.value = specItem.text; si.dispatchEvent(new Event('change',{bubbles:true})); }
      log('dom', `[cascade] ddlwh="${item.value}" â†’ ddlyjgg="${specItem.text}"`);
    }
  }
});
buildDDL('ddlyjgg', 'ContentPanel2', { noHidden: true });
buildDDL('ddlblxx', 'ContentPanel2', { badgeId:'badge-ddlblxx' });
buildDDL('ddldgwh', 'ContentPanel2', { noHidden: true, editable: true });

// â”€â”€ NumberBox spinner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function spinNum(inputId, delta) {
  const el = $(inputId);
  if (!el) return;
  const v = parseFloat(el.value) || 0;
  el.value = Math.max(0, v + delta);
  el.dispatchEvent(new Event('input',  {bubbles:true}));
  el.dispatchEvent(new Event('change', {bubbles:true}));
}

// â”€â”€ Button handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleBtnTJ() {
  // Collect form and add to grid
  const row = collectCurrentRow();
  if (!row.blyy) {
    alert('Please select ä¸è‰¯åŸå›  NguyÃªn nhÃ¢n!');
    return;
  }
  addGridRow(row);
  log('submit', `[btnTJ] Row added: MO=${row.mo} wh=${row.wh}`);
  try { window.parent.postMessage({ type:'iframe-row-add', payload: row }, '*'); } catch(e) {}
}

function handleBtnCZ() {
  // Reset ContentPanel2 fields
  ['ddlblyy','ddlclff','ddlzrdw','ddlqf','ddlcpzt','ddlzmb','ddlwh','ddlyjgg','ddlblxx','ddldgwh'].forEach(key => {
    const ti = document.querySelector(`[name="ContentPanel2$${key}"]`);
    const hi = document.querySelector(`[name="ContentPanel2$${key}$Value"]`);
    if (ti) { ti.value = ''; ti.dispatchEvent(new Event('change',{bubbles:true})); }
    if (hi) { hi.value = ''; }
  });
  ['tbxyjzq','tbxxlh','tbxwldm','tbxblsl','tbxnbz','tbxdxwhlh','tbxdxwhms'].forEach(key => {
    const el = document.querySelector(`[name="ContentPanel2$${key}"]`);
    if (el) { el.value = ''; el.dispatchEvent(new Event('change',{bubbles:true})); }
  });
  // Reset badges
  ['ddlblyy','ddlclff','ddlzrdw','ddlqf','ddlcpzt','ddlblxx'].forEach(k => {
    const b = $('badge-'+k);
    if (b) b.innerHTML = '$Value: <strong>â€”</strong>';
  });
  log('dom', '[btnCZ] Form reset');
}

function handleBtnGet() {
  const dgwh = document.querySelector('[name="ContentPanel2$ddldgwh"]');
  const val = dgwh ? dgwh.value : '';
  log('dom', `[btnGet] Fetching specs for multi-position: "${val}"`);
  if (!val) { alert('Please select å¤šé€‰ä½å· first!'); return; }
  // Simulate populate
  const el = document.querySelector('[name="ContentPanel2$tbxdxwhms"]');
  if (el) { el.value = 'CHIP-LAN-T|LED|IC|IND (simulated)'; el.dispatchEvent(new Event('change',{bubbles:true})); }
}

// â”€â”€ Grid data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GRID_ROWS = [
  { mo:'MY259023', blyy:'æ’ä»¶ Va cháº¡m,vá»¡',  clff:'è¡¥ä»¶ BÃ¹ kiá»‡n',                    zrdw:'åæ®µ CÃ´ng Ä‘oáº¡n sau',  qf:'æ¼ä»¶ Thiáº¿u liá»‡u',      zmb:'æ— ', wh:'T56', wldm:'2420500037', spec:'CHIP-LAN-T|éš”ç¦»å˜å‹å™¨|1000BASE-T', blxx:'æ‹¼ä¸é€š Ping KhÃ´ng thÃ´ng',       stt:'YCF9023011964', bz:'',      time:'2025/12/31 12:47:57' },
  { mo:'MY25B290', blyy:'ç¿˜ä»¶ Äá»©ng liá»‡u',   clff:'é‡æ–°ç„Šæ¥ Ä‘iá»u chá»‰nh vá»‹ trÃ­',        zrdw:'SMT',                 qf:'ç¿˜ä»¶ Äá»©ng liá»‡u',       zmb:'æ— ', wh:'U64', wldm:'3165500014', spec:'Directional coupler|SLCP06',      blxx:'åŠŸç‡ä½ CÃ´ng suáº¥t tháº¥p',         stt:'YCFB290007448', bz:'',      time:'2025/12/31 12:46:55' },
  { mo:'MY25B290', blyy:'ä¸è‰¯ Lá»—i',         clff:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u',    zrdw:'ç‰©æ–™ Váº­t liá»‡u',       qf:'åä»¶ liá»‡u há»ng',       zmb:'æ— ', wh:'U50', wldm:'3185500121', spec:'IC|Diplexer|SLFD18-5R950G',       blxx:'ç”µæºç¯ä¸äº® ÄÃ¨n nguá»“n KhÃ´ng sÃ¡ng',stt:'YCFB290008177', bz:'',      time:'2025/12/31 12:44:55' },
  { mo:'MY258508', blyy:'å…ƒä»¶ç ´æŸ Vá»¡ liá»‡u', clff:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u',    zrdw:'åæ®µ CÃ´ng Ä‘oáº¡n sau',  qf:'åä»¶ liá»‡u há»ng',       zmb:'æ— ', wh:'T45', wldm:'2420500037', spec:'CHIP-LAN-T|éš”ç¦»å˜å‹å™¨|1000BASE-T', blxx:'æ‹¼ä¸é€š Ping KhÃ´ng thÃ´ng',       stt:'YCF8508016798', bz:'99-17', time:'2025/12/31 12:41:18' },
  { mo:'MY25A196', blyy:'ä¸è‰¯ Lá»—i',         clff:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u',    zrdw:'ç‰©æ–™ Váº­t liá»‡u',       qf:'åä»¶ liá»‡u há»ng',       zmb:'æ— ', wh:'U1',  wldm:'/',          spec:'/',                               blxx:'ç”µæºç¯ä¸äº® ÄÃ¨n nguá»“n KhÃ´ng sÃ¡ng',stt:'YCFA196000334', bz:'99-28', time:'2025/12/31 12:39:35' },
  { mo:'MY25A346', blyy:'ä¸è‰¯ Lá»—i',         clff:'æ›´æ¢å…ƒä»¶ Thay Ä‘á»•i nguyÃªn liá»‡u',    zrdw:'ç‰©æ–™ Váº­t liá»‡u',       qf:'åä»¶ liá»‡u há»ng',       zmb:'æ— ', wh:'U28', wldm:'2175500575', spec:'IC|NAND FLASH|F50D1G41LB',        blxx:'åŠŸç‡ä½ CÃ´ng suáº¥t tháº¥p',         stt:'YCFA346000243', bz:'',      time:'2025/12/30 19:43:58' },
  { mo:'MY25B074', blyy:'åå‘ NgÆ°á»£c chiá»u', clff:'è°ƒæ•´è¡¥ç„Š Diá»u chá»‰nh BÃ¹ thiáº¿c',    zrdw:'SMT',                 qf:'æ–¹å‘å láº¯p ngÆ°á»£c liá»‡u', zmb:'å­æ¿',wh:'D1',  wldm:'2506500204', spec:'LED|3.2*1.0|ä¾§å‘å…‰|çº¢ç»¿è“ä¸‰è‰²',   blxx:'ç”µæºç¯ä¸äº® ÄÃ¨n nguá»“n KhÃ´ng sÃ¡ng',stt:'YCFB074000777', bz:'',      time:'2025/12/30 19:42:11' },
];

let rowCounter = GRID_ROWS.length;

function renderGrid(rows) {
  const tbody = $('grid-tbody');
  tbody.innerHTML = '';
  rows.forEach((r,i) => {
    const tr = document.createElement('tr');
    tr.className = i%2===1 ? 'alt' : '';
    tr.dataset.rowid = 'frow'+i;
    tr.innerHTML = `
      <td class="td-del"><a class="del-btn" href="javascript:void(0)" onclick="deleteRow(${i})" title="åˆ é™¤ xÃ³a bá»">âœ•</a></td>
      <td class="td-num">${i+1}</td>
      <td class="td-mo">${esc(r.mo)}</td>
      <td>${esc(r.blyy)}</td>
      <td>${esc(r.clff)}</td>
      <td>${esc(r.zrdw)}</td>
      <td>${esc(r.qf)}</td>
      <td>${esc(r.zmb)}</td>
      <td>${esc(r.wh)}</td>
      <td>${esc(r.wldm)}</td>
      <td class="td-spec" title="${esc(r.spec)}">${esc(r.spec)}</td>
      <td>${esc(r.blxx)}</td>
      <td class="td-stt">${esc(r.stt)}</td>
      <td>${esc(r.bz)}</td>
      <td class="td-time">${esc(r.time)}</td>
    `;
    tbody.appendChild(tr);
  });
}

function deleteRow(idx) {
  if (!confirm('ç¡®å®šåˆ é™¤æ­¤è®°å½•ï¼Ÿ Báº¡n cÃ³ cháº¯c cháº¯n xÃ³a báº£n ghi nÃ y khÃ´ng')) return;
  GRID_ROWS.splice(idx,1);
  renderGrid(GRID_ROWS);
  log('dom', `[grid] Row ${idx+1} deleted`);
}

function collectCurrentRow() {
  const g = n => {
    const el = document.querySelector(`[name="ContentPanel2$${n}"]`);
    return el ? el.value : '';
  };
  const g3 = n => {
    const el = document.querySelector(`[name="ContentPanel3$${n}"]`);
    return el ? el.value : '';
  };
  return {
    mo:   (document.querySelector('[name="ContentPanel1$tbxmo"]') || {}).value || 'UNKNOWN',
    blyy: g('ddlblyy'), clff: g('ddlclff'), zrdw: g('ddlzrdw'),
    qf:   g('ddlqf'),   zmb:  g('ddlzmb'),  wh:   g('ddlwh'),
    wldm: g('tbxwldm'), spec: g('ddlyjgg'), blxx: g('ddlblxx'),
    stt:  g('tbxxlh'),  bz:   g('tbxnbz'),
    time: new Date().toLocaleString('zh-CN').replace(',',''),
  };
}

function addGridRow(row) {
  GRID_ROWS.unshift(row);
  renderGrid(GRID_ROWS);
}

renderGrid(GRID_ROWS);

// â”€â”€ Global event monitoring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('change', function(e) {
  const t = e.target; if (!t.tagName) return;
  if (t.type === 'hidden') return; // hidden tracked separately
  const val = String(t.value).substring(0,50);
  log('change', `[${t.tagName.toLowerCase()}] name="${t.name||''}" id="${t.id||''}" â†’ "${val}"`);
}, true);

document.addEventListener('input', function(e) {
  const t = e.target;
  if (!t.tagName || t.type==='hidden') return;
  log('input', `[${t.tagName.toLowerCase()}] name="${t.name||''}" â†’ "${String(t.value).substring(0,30)}"`);
}, true);

// â”€â”€ Form submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('Form1').addEventListener('submit', function(e) {
  e.preventDefault();
  log('submit', 'Form1 submitted');

  const out = {};
  for (const [k,v] of new FormData(this).entries()) {
    if (out[k]!==undefined) {
      if (!Array.isArray(out[k])) out[k]=[out[k]];
      out[k].push(v);
    } else out[k]=v;
  }

  $('formOutput').textContent = JSON.stringify(out, null, 2);
  log('submit', `âœ… Payload: ${Object.keys(out).length} keys collected`);

  try { window.parent.postMessage({ type:'iframe-submit', payload:out }, '*'); } catch(e2){}
});

log('dom', `Form1 ready â€” ${new Date().toLocaleString()}`);
log('dom', `Fields: ContentPanel1(6) + ContentPanel2(17) + ContentPanel3(3 hidden) = 26 inputs`);
log('dom', `ComboBoxes with $Value: ddlxb, ddlblyy, ddlclff, ddlzrdw, ddlqf, ddlcpzt, ddlblxx`);
log('dom', `ComboBoxes WITHOUT $Value: ddlzmb, ddlwh, ddlyjgg, ddldgwh`);
</script>
</body>
</html>
